<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>2014.1_doc: xilflash_cfi.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.5 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>Globals</span></a></li>
  </ul></div>
<h1>xilflash_cfi.c File Reference</h1><code>#include &quot;xil_types.h&quot;</code><br>
<code>#include &quot;<a class="el" href="xilflash_8h.html">include/xilflash.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="xilflash__cfi_8h.html">include/xilflash_cfi.h</a>&quot;</code><br>
<code>#include &quot;xil_io.h&quot;</code><br>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="xilflash__cfi_8c.html#8236a4570aa3aa396c54ffdf8d9dc587">XFlashCFI_ReadCommon</a> (<a class="el" href="struct_x_flash_tag.html">XFlash</a> *InstancePtr, u8 BusWidth)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="xilflash__cfi_8c.html#07ca934c5b36189e95b86443217ea4fe">XFlashCFI_Read8</a> (u8 *Ptr, u8 Interleave, u8 Mode)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="xilflash__cfi_8c.html#81b0055478ea5e1140685e364200b839">XFlashCFI_Read16</a> (u8 *Ptr, u8 Interleave, u8 Mode)</td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
The file implements the functions for retrieval and translation of CFI data from a compliant flash device. CFI contains data that defines part geometry, write/erase timing, and programming data.<p>
Data is retrieved using macros defined in this xflash_cfi.h file. The macros simplify data extraction because they have been written to take into account the layout of parts on the data bus. To the library, CFI data appears as if it were always being read from a single 8-bit part (XFL_LAYOUT_X8_X8_X1) Otherwise, the retrieval code would have to contend with all the formats illustrated below. The illustration shows how the first three bytes of the CFI query data "QRY" appear in flash memory space for various part layouts. <pre></pre><p>
<pre>			Byte Offset (Big-Endian)
			0123456789ABCDEF
			----------------
			XFL_LAYOUT_X16_X16_X1	Q R Y
			XFL_LAYOUT_X16_X16_X2	Q Q R R Y Y
 </pre><p>
Where the holes between Q, R, and Y are NULL (all bits 0)<p>
<dl compact><dt><b>Note:</b></dt><dd></dd></dl>
This code is intended to be RTOS and processor independent. It works with physical addresses only. Any needs for dynamic memory management, threads, mutual exclusion, virtual memory, or cache control management must be satisfied by the layer above this library.<p>
<pre>
 MODIFICATION HISTORY:</pre><p>
<pre> Ver   Who  Date     Changes
 ----- ---- -------- -----------------------------------------------
 1.00a rmm  10/25/07 First release
 1.00a mta  10/25/07 Updated to flash library
 1.01a ksu  04/10/08 Added support for AMD CFI Interface
 1.02a ksu  08/06/09 Added code to read the platform flash bank information
 2.00a ktn  12/04/09 Updated to use the HAL processor APIs/macros
 2.02a sdm  06/30/10 Updated to support AXI EMC with Little Endian Processor
 3.00a sdm  03/03/11 Removed static parameters in mld and updated code to
		      determine these parameters from the CFI data.
 3.01a srt  03/02/12 Added support for Micron G18 Flash device to fix
		      CRs 648372, 648282.
		      Added DATA_SYNC to fix the CR 644750.
 3.02a srt  05/30/12 Changed Implementation for Micron G18 Flash, which
		      fixes the CR 662317.
		      CR 662317 Description - Xilinx Platform Flash on ML605
		      fails to work.
 3.04a srt  02/18/13 Fixed CR 700553.
 </pre> <hr><h2>Function Documentation</h2>
<a class="anchor" name="81b0055478ea5e1140685e364200b839"></a><!-- doxytag: member="xilflash_cfi.c::XFlashCFI_Read16" ref="81b0055478ea5e1140685e364200b839" args="(u8 *Ptr, u8 Interleave, u8 Mode)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int XFlashCFI_Read16           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">u8 *&nbsp;</td>
          <td class="mdname" nowrap> <em>Ptr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>u8&nbsp;</td>
          <td class="mdname" nowrap> <em>Interleave</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>u8&nbsp;</td>
          <td class="mdname" nowrap> <em>Mode</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Reads 16-bits of data from the CFI data location into a local variable.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>Ptr</em>&nbsp;</td><td>is the pointer to read. Can be a pointer to any type. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Interleave</em>&nbsp;</td><td>is the byte interleaving (based on part layout). </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Mode</em>&nbsp;</td><td>is the mode of operation (based on part layout).</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>The 16-bit value at Ptr adjusted for the interleave factor. </dd></dl>
    </td>
  </tr>
</table>
<a class="anchor" name="07ca934c5b36189e95b86443217ea4fe"></a><!-- doxytag: member="xilflash_cfi.c::XFlashCFI_Read8" ref="07ca934c5b36189e95b86443217ea4fe" args="(u8 *Ptr, u8 Interleave, u8 Mode)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int XFlashCFI_Read8           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">u8 *&nbsp;</td>
          <td class="mdname" nowrap> <em>Ptr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>u8&nbsp;</td>
          <td class="mdname" nowrap> <em>Interleave</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>u8&nbsp;</td>
          <td class="mdname" nowrap> <em>Mode</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Reads 8-bits of data from the CFI data location into a local variable.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>Ptr</em>&nbsp;</td><td>is the pointer to read. Can be a pointer to any type. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Interleave</em>&nbsp;</td><td>is the byte interleaving (based on part layout). </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Mode</em>&nbsp;</td><td>is the mode of operation (based on part layout).</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>The byte at Ptr adjusted for the interleave factor. </dd></dl>
    </td>
  </tr>
</table>
<a class="anchor" name="8236a4570aa3aa396c54ffdf8d9dc587"></a><!-- doxytag: member="xilflash_cfi.c::XFlashCFI_ReadCommon" ref="8236a4570aa3aa396c54ffdf8d9dc587" args="(XFlash *InstancePtr, u8 BusWidth)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int XFlashCFI_ReadCommon           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="struct_x_flash_tag.html">XFlash</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>InstancePtr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>u8&nbsp;</td>
          <td class="mdname" nowrap> <em>BusWidth</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Retrieves the standard CFI data from the part(s), interpret the data, and update the provided geometry and properties structures.<p>
Extended CFI data is part specific and ignored here. This data must be read by the specific flash device family library.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>InstancePtr</em>&nbsp;</td><td>is the pointer to the XFlash instance. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>BusWidth</em>&nbsp;</td><td>is the total width of the flash memory, in bytes.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd><ul>
<li>XST_SUCCESS if successful.</li><li>XFLASH_CFI_QUERY_ERROR if an error occurred interpreting the data.</li><li>XFLASH_PART_NOT_SUPPORTED if invalid Layout parameter.</li></ul>
</dd></dl>
<dl compact><dt><b>Note:</b></dt><dd>None. </dd></dl>
    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Thu Feb 13 14:37:13 2014 for 2014.1_doc by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.5 </small></address>
</body>
</html>
