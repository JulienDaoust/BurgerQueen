<html>
<head>
   <meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>
   xsdps v2_1
</title>
<link href="$DriverApiDocsCssPath" rel="stylesheet" type="text/css">
</head>
<h3 class="PageHeader">Xilinx Processor IP Library</h3>
<hl>Software Drivers</hl>
<hr class="whs1">
<!-- Generated by Doxygen 1.4.5 -->
<div class="tabs">
  <ul>
    <li id="current"><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li><a href="files.html"><span>Files</span></a></li>
  </ul></div>
<h1>xsdps v2_1</h1>
<p>
This file contains the implementation of <a class="el" href="struct_x_sd_ps.html">XSdPs</a> driver. This driver is used initialize read from and write to the SD card. Features such as switching bus width to 4-bit and switching to high speed, changing clock frequency, block size etc. are supported. SD 2.0 uses 1/4 bus width and speeds of 25/50KHz. Initialization, however is done using 1-bit bus width and 400KHz clock frequency. SD commands are classified as broadcast and addressed. Commands can be those with response only (using only command line) or response + data (using command and data lines). Only one command can be sent at a time. During a data transfer however, when dsta lines are in use, certain commands (which use only the command line) can be sent, most often to obtain status. This driver does not support multi card slots at present.<p>
Intialization: This includes initialization on the host controller side to select clock frequency, bus power and default transfer related parameters. The default voltage is 3.3V. On the SD card side, the initialization and identification state diagram is implemented. This resets the card, gives it a unique address/ID and identifies key card related specifications.<p>
Data transfer: The SD card is put in tranfer state to read from or write to it. The default block size is 512 bytes and if supported, default bus width is 4-bit and bus speed is High speed. The read and write functions are implemented in polled mode using ADMA2.<p>
At any point, when key parameters such as block size or clock/speed or bus width are modified, this driver takes care of maintaining the same selection on host and card. All error bits in host controller are monitored by the driver and in the event one of them is set, driver will clear the interrupt status and communicate failure to the upper layer.<p>
File system use: This driver can be used with xilffs library to read and write files to SD. (Please refer to procedure in diskio.c). The file system read/write example in polled mode can used for reference.<p>
There is no example for using SD driver without file system at present. However, the driver can be used without the file system. The glue layer in filesytem can be used as reference for the same. The block count passed to the read/write function in one call is limited by the ADMA2 descriptor table and hence care will have to be taken to call read/write API's in a loop for large file sizes.<p>
Interrupt mode is not supported because it offers no improvement when used with file system.<p>
eMMC support: SD driver supports SD and eMMC based on the "enable MMC" parameter in SDK. The features of eMMC supported by the driver will depend on those supported by the host controller. The current driver supports read/write on eMMC card using 4-bit and high speed mode currently.<p>
Features not supported include - card write protect, password setting, lock/unlock, interrupts, SDMA mode, programmed I/O mode and 64-bit addressed ADMA2, erase/pre-erase commands.<p>
<pre>
 MODIFICATION HISTORY:</pre><p>
<pre> Ver   Who    Date     Changes
 ----- ---    -------- -----------------------------------------------
 1.00a hk/sg  10/17/13 Initial release
 2.0   hk      03/07/14 Version number revised.
 2.1   hk     04/18/14 Increase sleep for eMMC switch command.
                       Add sleep for microblaze designs. CR# 781117.</pre><p>
<pre> </pre> Copyright @ 1995-2014 Xilinx, Inc. All rights reserved. 
