<html>
<head>
   <meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>
   Xilinx Driver iicps v2_2: xiicps_slave.c File Reference
</title>
<link href="doxygen_kalyanidocs/doc/css/driver_api_doxygen.css" rel="stylesheet" type="text/css">
</head>
<h3 class="PageHeader">Xilinx Processor IP Library</h3>
<hl>Software Drivers</hl>
<hr class="whs1">

<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>xiicps_slave.c File Reference</h1><code>#include &quot;<a class="el" href="xiicps_8h.html">xiicps.h</a>&quot;</code><br/>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="xiicps__slave_8c.html#a6bf043d1f4ee43a6491cae17d69d6aab">TransmitFifoFill</a> (<a class="el" href="struct_x_iic_ps.html">XIicPs</a> *InstancePtr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="xiicps__slave_8c.html#ad1c7ffa09df93fb59f97b0a3bf5baaa7">XIicPs_SetupSlave</a> (<a class="el" href="struct_x_iic_ps.html">XIicPs</a> *InstancePtr, u16 SlaveAddr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="xiicps__slave_8c.html#a1a39e62019a5ec05553783cac9407c04">XIicPs_SlaveSend</a> (<a class="el" href="struct_x_iic_ps.html">XIicPs</a> *InstancePtr, u8 *MsgPtr, int ByteCount)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="xiicps__slave_8c.html#a254caa9f98a43ad9d9f70578c6755d18">XIicPs_SlaveRecv</a> (<a class="el" href="struct_x_iic_ps.html">XIicPs</a> *InstancePtr, u8 *MsgPtr, int ByteCount)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="xiicps__slave_8c.html#a5c1c2808b9167c733286e3ececdb492d">XIicPs_SlaveSendPolled</a> (<a class="el" href="struct_x_iic_ps.html">XIicPs</a> *InstancePtr, u8 *MsgPtr, int ByteCount)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="xiicps__slave_8c.html#ac5aaa093732d91f467cec3afba9db192">XIicPs_SlaveRecvPolled</a> (<a class="el" href="struct_x_iic_ps.html">XIicPs</a> *InstancePtr, u8 *MsgPtr, int ByteCount)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="xiicps__slave_8c.html#a716cdb9f63e56269824866872958dd78">XIicPs_SlaveInterruptHandler</a> (<a class="el" href="struct_x_iic_ps.html">XIicPs</a> *InstancePtr)</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Handles slave transfers</p>
<pre> MODIFICATION HISTORY:</pre><pre> Ver   Who Date     Changes
 ----- --  -------- ---------------------------------------------
 1.00a jz  01/30/10 First release
 1.04a kpc 08/30/13 Avoid buffer overwrite in SlaveRecvData function</pre><pre> </pre> <hr/><h2>Function Documentation</h2>
<a class="anchor" id="a6bf043d1f4ee43a6491cae17d69d6aab"></a><!-- doxytag: member="xiicps_slave.c::TransmitFifoFill" ref="a6bf043d1f4ee43a6491cae17d69d6aab" args="(XIicPs *InstancePtr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int TransmitFifoFill </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_x_iic_ps.html">XIicPs</a> *&nbsp;</td>
          <td class="paramname"> <em>InstancePtr</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Put more data into the transmit FIFO, number of bytes is ether expected number of bytes for this transfer or available space in FIFO, which ever is less.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>InstancePtr</em>&nbsp;</td><td>is a pointer to the <a class="el" href="struct_x_iic_ps.html">XIicPs</a> instance.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Number of bytes left for this instance.</dd></dl>
<dl class="note"><dt><b>Note:</b></dt><dd>This is function is shared by master and slave. </dd></dl>

</div>
</div>
<a class="anchor" id="ad1c7ffa09df93fb59f97b0a3bf5baaa7"></a><!-- doxytag: member="xiicps_slave.c::XIicPs_SetupSlave" ref="ad1c7ffa09df93fb59f97b0a3bf5baaa7" args="(XIicPs *InstancePtr, u16 SlaveAddr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void XIicPs_SetupSlave </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_x_iic_ps.html">XIicPs</a> *&nbsp;</td>
          <td class="paramname"> <em>InstancePtr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u16&nbsp;</td>
          <td class="paramname"> <em>SlaveAddr</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function sets up the device to be a slave.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>InstancePtr</em>&nbsp;</td><td>is a pointer to the <a class="el" href="struct_x_iic_ps.html">XIicPs</a> instance. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>SlaveAddr</em>&nbsp;</td><td>is the address of the slave we are receiving from.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>None.</dd></dl>
<dl class="note"><dt><b>Note:</b></dt><dd>Interrupt is always enabled no matter the tranfer is interrupt- driven or polled mode. Whether device will be interrupted or not depends on whether the device is connected to an interrupt controller and interrupt for the device is enabled. </dd></dl>

</div>
</div>
<a class="anchor" id="a716cdb9f63e56269824866872958dd78"></a><!-- doxytag: member="xiicps_slave.c::XIicPs_SlaveInterruptHandler" ref="a716cdb9f63e56269824866872958dd78" args="(XIicPs *InstancePtr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void XIicPs_SlaveInterruptHandler </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_x_iic_ps.html">XIicPs</a> *&nbsp;</td>
          <td class="paramname"> <em>InstancePtr</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>The interrupt handler for slave mode. It does the protocol handling for the interrupt-driven transfers.</p>
<p>Completion events and errors are signaled to upper layer for proper handling.</p>
<pre></pre><pre> The interrupts that are handled are:</p>
<ul>
<li>DATA
	If the instance is sending, it means that the master wants to read more
	data from us. Send more data, and check whether we are done with this
	send.</li>
</ul>
</pre><pre>	If the instance is receiving, it means that the master has writen
 	more data to us. Receive more data, and check whether we are done with
	with this receive.</pre><pre><ul>
<li>COMP
	This marks that stop sequence has been sent from the master, transfer
	is about to terminate. However, for receiving, the master may have
	written us some data, so receive that first.</li>
</ul>
</pre><pre>	It is an error if the amount of transfered data is less than expected.</pre><pre><ul>
<li>NAK
	This marks that master does not want our data. It is for send only.</li>
</ul>
</pre><pre><ul>
<li>Other interrupts
	These interrupts are marked as error.</li>
</ul>
</pre><pre> </pre><dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>InstancePtr</em>&nbsp;</td><td>is a pointer to the <a class="el" href="struct_x_iic_ps.html">XIicPs</a> instance.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>None.</dd></dl>
<dl class="note"><dt><b>Note:</b></dt><dd>None. </dd></dl>

</div>
</div>
<a class="anchor" id="a254caa9f98a43ad9d9f70578c6755d18"></a><!-- doxytag: member="xiicps_slave.c::XIicPs_SlaveRecv" ref="a254caa9f98a43ad9d9f70578c6755d18" args="(XIicPs *InstancePtr, u8 *MsgPtr, int ByteCount)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void XIicPs_SlaveRecv </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_x_iic_ps.html">XIicPs</a> *&nbsp;</td>
          <td class="paramname"> <em>InstancePtr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u8 *&nbsp;</td>
          <td class="paramname"> <em>MsgPtr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>ByteCount</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function setup a slave interrupt-driven receive. Data processing for the receive is handled by the interrupt handler.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>InstancePtr</em>&nbsp;</td><td>is a pointer to the <a class="el" href="struct_x_iic_ps.html">XIicPs</a> instance. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>MsgPtr</em>&nbsp;</td><td>is the pointer to the receive buffer. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ByteCount</em>&nbsp;</td><td>is the number of bytes to be received.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>None.</dd></dl>
<dl class="note"><dt><b>Note:</b></dt><dd>This routine is for interrupt-driven transfer only. </dd></dl>

</div>
</div>
<a class="anchor" id="ac5aaa093732d91f467cec3afba9db192"></a><!-- doxytag: member="xiicps_slave.c::XIicPs_SlaveRecvPolled" ref="ac5aaa093732d91f467cec3afba9db192" args="(XIicPs *InstancePtr, u8 *MsgPtr, int ByteCount)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int XIicPs_SlaveRecvPolled </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_x_iic_ps.html">XIicPs</a> *&nbsp;</td>
          <td class="paramname"> <em>InstancePtr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u8 *&nbsp;</td>
          <td class="paramname"> <em>MsgPtr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>ByteCount</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function receives a buffer in polled mode as a slave.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>InstancePtr</em>&nbsp;</td><td>is a pointer to the <a class="el" href="struct_x_iic_ps.html">XIicPs</a> instance. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>MsgPtr</em>&nbsp;</td><td>is the pointer to the receive buffer. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ByteCount</em>&nbsp;</td><td>is the number of bytes to be received.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd><ul>
<li>XST_SUCCESS if everything went well.</li>
<li>XST_FAILURE if timed out.</li>
</ul>
</dd></dl>
<dl class="note"><dt><b>Note:</b></dt><dd>This receive routine is for polled mode transfer only. </dd></dl>

</div>
</div>
<a class="anchor" id="a1a39e62019a5ec05553783cac9407c04"></a><!-- doxytag: member="xiicps_slave.c::XIicPs_SlaveSend" ref="a1a39e62019a5ec05553783cac9407c04" args="(XIicPs *InstancePtr, u8 *MsgPtr, int ByteCount)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void XIicPs_SlaveSend </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_x_iic_ps.html">XIicPs</a> *&nbsp;</td>
          <td class="paramname"> <em>InstancePtr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u8 *&nbsp;</td>
          <td class="paramname"> <em>MsgPtr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>ByteCount</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function setup a slave interrupt-driven send. It set the repeated start for the device is the tranfer size is larger than FIFO depth. Data processing for the send is initiated by the interrupt handler.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>InstancePtr</em>&nbsp;</td><td>is a pointer to the <a class="el" href="struct_x_iic_ps.html">XIicPs</a> instance. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>MsgPtr</em>&nbsp;</td><td>is the pointer to the send buffer. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ByteCount</em>&nbsp;</td><td>is the number of bytes to be sent.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>None.</dd></dl>
<dl class="note"><dt><b>Note:</b></dt><dd>This send routine is for interrupt-driven transfer only. </dd></dl>

</div>
</div>
<a class="anchor" id="a5c1c2808b9167c733286e3ececdb492d"></a><!-- doxytag: member="xiicps_slave.c::XIicPs_SlaveSendPolled" ref="a5c1c2808b9167c733286e3ececdb492d" args="(XIicPs *InstancePtr, u8 *MsgPtr, int ByteCount)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int XIicPs_SlaveSendPolled </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_x_iic_ps.html">XIicPs</a> *&nbsp;</td>
          <td class="paramname"> <em>InstancePtr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u8 *&nbsp;</td>
          <td class="paramname"> <em>MsgPtr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>ByteCount</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function sends a buffer in polled mode as a slave.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>InstancePtr</em>&nbsp;</td><td>is a pointer to the <a class="el" href="struct_x_iic_ps.html">XIicPs</a> instance. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>MsgPtr</em>&nbsp;</td><td>is the pointer to the send buffer. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ByteCount</em>&nbsp;</td><td>is the number of bytes to be sent.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd><ul>
<li>XST_SUCCESS if everything went well.</li>
<li>XST_FAILURE if master sends us data or master terminates the transfer before all data has sent out.</li>
</ul>
</dd></dl>
<dl class="note"><dt><b>Note:</b></dt><dd>This send routine is for polled mode transfer only. </dd></dl>

</div>
</div>
</div>
<p class="Copyright">
Copyright &copy; 1995-2014 Xilinx, Inc. All rights reserved.
</p>
</body>
</html>
