<html>
<head>
   <meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>
   xscugic_hw.c File Reference
</title>
<link href="$DriverApiDocsCssPath" rel="stylesheet" type="text/css">
</head>
<h3 class="PageHeader">Xilinx Processor IP Library</h3>
<hl>Software Drivers</hl>
<hr class="whs1">
<!-- Generated by Doxygen 1.4.5 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
  </ul></div>
<h1>xscugic_hw.c File Reference</h1><hr><a name="_details"></a><h2>Detailed Description</h2>
This file contains low-level driver functions that can be used to access the device. The user should refer to the hardware device specification for more details of the device operation. These routines are used when the user does not want to create an instance of <a class="el" href="struct_x_scu_gic.html">XScuGic</a> structure but still wants to use the ScuGic device. Hence the routines provided here take device id or scugic base address as arguments. Separate static versions of DistInit and CPUInit are provided to implement the low level driver routines.<p>
<pre>
 MODIFICATION HISTORY:</pre><p>
<pre> Ver   Who  Date     Changes
 ----- ---- -------- -------------------------------------------------------
 1.01a sdm  07/18/11 First release
 1.03a srt  02/27/13 Moved Offset calculation macros from *_hw.c (CR
		      702687).
					  Added support to direct interrupts to the appropriate CPU.
			  Earlier interrupts were directed to CPU1 (hard coded). Now
			  depending upon the CPU selected by the user (xparameters.h),
			  interrupts will be directed to the relevant CPU.
			  This fixes CR 699688.
 1.04a hk   05/04/13 Fix for CR#705621. Moved functions
			  XScuGic_SetPriTrigTypeByDistAddr and
             XScuGic_GetPriTrigTypeByDistAddr here from <a class="el" href="xscugic_8c.html">xscugic.c</a></pre><p>
<pre> </pre> 
<p>
<code>#include &quot;xparameters.h&quot;</code><br>
<code>#include &quot;xil_types.h&quot;</code><br>
<code>#include &quot;xil_assert.h&quot;</code><br>
<code>#include &quot;xscugic.h&quot;</code><br>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="xscugic__hw_8c.html#09d25627a092c913ba2da72581befe7f">XScuGic_DeviceInitialize</a> (u32 DeviceId)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="xscugic__hw_8c.html#97d60ac7ec7052764cea9a49ed2eddf6">XScuGic_DeviceInterruptHandler</a> (void *DeviceId)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="xscugic__hw_8c.html#8801694fe6955c01a57eb79e7051e751">XScuGic_RegisterHandler</a> (u32 BaseAddress, int InterruptId, Xil_InterruptHandler Handler, void *CallBackRef)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="xscugic__hw_8c.html#176144512a1c81f6b4f2ad2c51dce289">XScuGic_SetPriTrigTypeByDistAddr</a> (u32 DistBaseAddress, u32 Int_Id, u8 Priority, u8 Trigger)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="xscugic__hw_8c.html#57ce50ab23b8fed89ff9d5f80e4e3591">XScuGic_GetPriTrigTypeByDistAddr</a> (u32 DistBaseAddress, u32 Int_Id, u8 *Priority, u8 *Trigger)</td></tr>

<tr><td colspan="2"><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="struct_x_scu_gic___config.html">XScuGic_Config</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="xscugic__hw_8c.html#6a744683e97ef1a88b065313d4fc4f2f">XScuGic_ConfigTable</a> []</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="09d25627a092c913ba2da72581befe7f"></a><!-- doxytag: member="xscugic_hw.c::XScuGic_DeviceInitialize" ref="09d25627a092c913ba2da72581befe7f" args="(u32 DeviceId)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int XScuGic_DeviceInitialize           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">u32&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>DeviceId</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
CfgInitialize a specific interrupt controller instance/driver. The initialization entails:<p>
<ul>
<li>Initialize fields of the <a class="el" href="struct_x_scu_gic.html">XScuGic</a> structure</li><li>Initial vector table with stub function calls</li><li>All interrupt sources are disabled</li></ul>
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>InstancePtr</em>&nbsp;</td><td>is a pointer to the <a class="el" href="struct_x_scu_gic.html">XScuGic</a> instance to be worked on. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ConfigPtr</em>&nbsp;</td><td>is a pointer to a config table for the particular device this driver is associated with. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>EffectiveAddr</em>&nbsp;</td><td>is the device base address in the virtual memory address space. The caller is responsible for keeping the address mapping from EffectiveAddr to the device physical base address unchanged once this function is invoked. Unexpected errors may occur if the address mapping changes after this function is called. If address translation is not used, use Config-&gt;BaseAddress for this parameters, passing the physical address instead.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd></dd></dl>
<ul>
<li>XST_SUCCESS if initialization was successful</li></ul>
<p>
<dl compact><dt><b>Note:</b></dt><dd></dd></dl>
None.     </td>
  </tr>
</table>
<a class="anchor" name="97d60ac7ec7052764cea9a49ed2eddf6"></a><!-- doxytag: member="xscugic_hw.c::XScuGic_DeviceInterruptHandler" ref="97d60ac7ec7052764cea9a49ed2eddf6" args="(void *DeviceId)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void XScuGic_DeviceInterruptHandler           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>DeviceId</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function is the primary interrupt handler for the driver. It must be connected to the interrupt source such that it is called when an interrupt of the interrupt controller is active. It will resolve which interrupts are active and enabled and call the appropriate interrupt handler. It uses the Interrupt Type information to determine when to acknowledge the interrupt.Highest priority interrupts are serviced first.<p>
This function assumes that an interrupt vector table has been previously initialized. It does not verify that entries in the table are valid before calling an interrupt handler.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>DeviceId</em>&nbsp;</td><td>is the unique identifier for the ScuGic device.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>None.</dd></dl>
<dl compact><dt><b>Note:</b></dt><dd>None. </dd></dl>
    </td>
  </tr>
</table>
<a class="anchor" name="57ce50ab23b8fed89ff9d5f80e4e3591"></a><!-- doxytag: member="xscugic_hw.c::XScuGic_GetPriTrigTypeByDistAddr" ref="57ce50ab23b8fed89ff9d5f80e4e3591" args="(u32 DistBaseAddress, u32 Int_Id, u8 *Priority, u8 *Trigger)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void XScuGic_GetPriTrigTypeByDistAddr           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">u32&nbsp;</td>
          <td class="mdname" nowrap> <em>DistBaseAddress</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>u32&nbsp;</td>
          <td class="mdname" nowrap> <em>Int_Id</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>u8 *&nbsp;</td>
          <td class="mdname" nowrap> <em>Priority</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>u8 *&nbsp;</td>
          <td class="mdname" nowrap> <em>Trigger</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Gets the interrupt priority and trigger type for the specificd IRQ source.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>BaseAddr</em>&nbsp;</td><td>is the device base address </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Int_Id</em>&nbsp;</td><td>is the IRQ source number to modify </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Priority</em>&nbsp;</td><td>is a pointer to the value of the priority of the IRQ source. This is a return value. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Trigger</em>&nbsp;</td><td>is pointer to the value of the trigger of the IRQ source. This is a return value.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>None.</dd></dl>
<dl compact><dt><b>Note:</b></dt><dd>This API has the similar functionality of XScuGic_GetPriority TriggerType() and should be used when there is no InstancePtr. </dd></dl>
    </td>
  </tr>
</table>
<a class="anchor" name="8801694fe6955c01a57eb79e7051e751"></a><!-- doxytag: member="xscugic_hw.c::XScuGic_RegisterHandler" ref="8801694fe6955c01a57eb79e7051e751" args="(u32 BaseAddress, int InterruptId, Xil_InterruptHandler Handler, void *CallBackRef)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void XScuGic_RegisterHandler           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">u32&nbsp;</td>
          <td class="mdname" nowrap> <em>BaseAddress</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>InterruptId</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>Xil_InterruptHandler&nbsp;</td>
          <td class="mdname" nowrap> <em>Handler</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>void *&nbsp;</td>
          <td class="mdname" nowrap> <em>CallBackRef</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Register a handler function for a specific interrupt ID. The vector table of the interrupt controller is updated, overwriting any previous handler. The handler function will be called when an interrupt occurs for the given interrupt ID.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>BaseAddress</em>&nbsp;</td><td>is the CPU Interface Register base address of the interrupt controller whose vector table will be modified. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>InterruptId</em>&nbsp;</td><td>is the interrupt ID to be associated with the input handler. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Handler</em>&nbsp;</td><td>is the function pointer that will be added to the vector table for the given interrupt ID. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>CallBackRef</em>&nbsp;</td><td>is the argument that will be passed to the new handler function when it is called. This is user-specific.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>None.</dd></dl>
<dl compact><dt><b>Note:</b></dt><dd></dd></dl>
Note that this function has no effect if the input base address is invalid.     </td>
  </tr>
</table>
<a class="anchor" name="176144512a1c81f6b4f2ad2c51dce289"></a><!-- doxytag: member="xscugic_hw.c::XScuGic_SetPriTrigTypeByDistAddr" ref="176144512a1c81f6b4f2ad2c51dce289" args="(u32 DistBaseAddress, u32 Int_Id, u8 Priority, u8 Trigger)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void XScuGic_SetPriTrigTypeByDistAddr           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">u32&nbsp;</td>
          <td class="mdname" nowrap> <em>DistBaseAddress</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>u32&nbsp;</td>
          <td class="mdname" nowrap> <em>Int_Id</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>u8&nbsp;</td>
          <td class="mdname" nowrap> <em>Priority</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>u8&nbsp;</td>
          <td class="mdname" nowrap> <em>Trigger</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Sets the interrupt priority and trigger type for the specificd IRQ source.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>BaseAddr</em>&nbsp;</td><td>is the device base address </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Int_Id</em>&nbsp;</td><td>is the IRQ source number to modify </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Priority</em>&nbsp;</td><td>is the new priority for the IRQ source. 0 is highest priority, 0xF8 (248) is lowest. There are 32 priority levels supported with a step of 8. Hence the supported priorities are 0, 8, 16, 32, 40 ..., 248. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Trigger</em>&nbsp;</td><td>is the new trigger type for the IRQ source. Each bit pair describes the configuration for an INT_ID. SFI Read Only b10 always PPI Read Only depending on how the PPIs are configured. b01 Active HIGH level sensitive b11 Rising edge sensitive SPI LSB is read only. b01 Active HIGH level sensitive b11 Rising edge sensitive/</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>None.</dd></dl>
<dl compact><dt><b>Note:</b></dt><dd>This API has the similar functionality of XScuGic_SetPriority TriggerType() and should be used when there is no InstancePtr. </dd></dl>
    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="6a744683e97ef1a88b065313d4fc4f2f"></a><!-- doxytag: member="xscugic_hw.c::XScuGic_ConfigTable" ref="6a744683e97ef1a88b065313d4fc4f2f" args="[]" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="struct_x_scu_gic___config.html">XScuGic_Config</a> <a class="el" href="xscugic__sinit_8c.html#6a744683e97ef1a88b065313d4fc4f2f">XScuGic_ConfigTable</a>[]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This table contains configuration information for each GIC device in the system. The <a class="el" href="struct_x_scu_gic.html">XScuGic</a> driver must know when to acknowledge the interrupt. The entry which specifies this as a bit mask where each bit corresponds to a specific interrupt. A bit set indicates to ACK it before servicing it. Generally, acknowledge before service is used when the interrupt signal is edge-sensitive, and after when the signal is level-sensitive.<p>
Refer to the <a class="el" href="struct_x_scu_gic___config.html">XScuGic_Config</a> data structure in xscugic.h for details on how this table should be initialized.     </td>
  </tr>
</table>
Copyright @ 1995-2014 Xilinx, Inc. All rights reserved. 
